<div class="container">
  <div class="row mb-5">
    <div id="last_7d_food_journal" class="col"></div>
    <div id="last_30d_food_journal" class="col"></div>
  </div>
  <div class="row">
    <div class="outlets_last_ordered col">
      <h3>Outlets - By last order date</h3>
      <table class="table table-striped table-hover">
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Last Ordered At</th>
        </tr>
        <% outlet_sorted_last_ordered.each do |outlet| %>
          <tr id="<%= dom_id outlet %>" scope="row">
            <td><%= outlet.name %></td>
            <td><%= outlet.last_ordered_at&.strftime(ApplicationHelper::INDIA_DATE_FORMAT) %></td>
          </tr>
        <% end %>
      </table>
    </div>
    <div class="col" id="last_7d_outlet_count"> </div>
    <div class="col" id="last_30d_outlet_count"> </div>
  </div>
</div>

<script type="text/javascript">
  Highcharts.chart('last_7d_food_journal', {
    chart: {
      type: 'pie'
    },
    title: {
      text: 'Last 7d Summary'
    },
    tooltip: {
      valueSuffix: '%'
    },
    subtitle: {
    },
    plotOptions: {
      series: {
        allowPointSelect: true,
        cursor: 'pointer',
        dataLabels: [{
          enabled: true,
          distance: 20
        }, {
          enabled: true,
          distance: -40,
          format: '{point.percentage:.2f}%',
          style: {
            fontSize: '1.2em',
            textOutline: 'none',
            opacity: 0.7
          },
          filter: {
            operator: '>',
            property: 'percentage',
            value: 10
          }
        }]
      }
    },
    series: [
    {
      name: 'Percentage',
      colorByPoint: true,
      data: <%= raw(food_journal_pie(7.days).to_json) %>
    }
    ]
  });

  Highcharts.chart('last_30d_food_journal', {
    chart: {
      type: 'pie'
    },
    title: {
      text: 'Last 30d Summary'
    },
    tooltip: {
      valueSuffix: '%'
    },
    subtitle: {
    },
    plotOptions: {
      series: {
        allowPointSelect: true,
        cursor: 'pointer',
        dataLabels: [{
          enabled: true,
          distance: 20
        }, {
          enabled: true,
          distance: -40,
          format: '{point.percentage:.2f}%',
          style: {
            fontSize: '1.2em',
            textOutline: 'none',
            opacity: 0.7
          },
          filter: {
            operator: '>',
            property: 'percentage',
            value: 10
          }
        }]
      }
    },
    series: [
    {
      name: 'Percentage',
      colorByPoint: true,
      data: <%= raw(food_journal_pie(30.days).to_json) %>
    }
    ]
  });

  Highcharts.chart('last_7d_outlet_count', {
    chart: {
      type: 'pie'
    },
    title: {
      text: 'Last 7d Outlet orders'
    },
    tooltip: {
      valueSuffix: '%'
    },
    subtitle: {
    },
    plotOptions: {
      series: {
        allowPointSelect: true,
        cursor: 'pointer',
        dataLabels: [{
          enabled: true,
          distance: 20
        }, {
          enabled: true,
          distance: -40,
          format: '{point.percentage:.2f}%',
          style: {
            fontSize: '1.2em',
            textOutline: 'none',
            opacity: 0.7
          },
          filter: {
            operator: '>',
            property: 'percentage',
            value: 10
          }
        }]
      }
    },
    series: [
    {
      name: 'Percentage',
      colorByPoint: true,
      data: <%= raw(outlet_order_pie(7.days).to_json) %>
    }
    ]
  });

  Highcharts.chart('last_30d_outlet_count', {
    chart: {
      type: 'pie'
    },
    title: {
      text: 'Last 30d Outlet orders'
    },
    tooltip: {
      valueSuffix: '%'
    },
    subtitle: {
    },
    plotOptions: {
      series: {
        allowPointSelect: true,
        cursor: 'pointer',
        dataLabels: [{
          enabled: true,
          distance: 20
        }, {
          enabled: true,
          distance: -40,
          format: '{point.percentage:.2f}%',
          style: {
            fontSize: '1.2em',
            textOutline: 'none',
            opacity: 0.7
          },
          filter: {
            operator: '>',
            property: 'percentage',
            value: 10
          }
        }]
      }
    },
    series: [
    {
      name: 'Percentage',
      colorByPoint: true,
      data: <%= raw(outlet_order_pie(30.days).to_json) %>
    }
    ]
  });


</script>
